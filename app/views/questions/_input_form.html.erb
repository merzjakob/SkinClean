<% if question  %>
  <%= simple_form_for [question, patient_answer], remote: true, html: {id: "chatForm"} do |f| %>
    <% if question.multiple_choice %>
        <%= f.input :content, as: :radio_buttons, collection: question.answers.pluck(:content), label: false, wrapper_html: { class: "choices" }, input_html: { class: "choice hidden" } %>
  <!--     <div class="fix-height"> -->
    <% else %>
        <% if question.photo %>



          <video id="video" width="100" height="200" autoplay></video>
          <button id="snap"><i class="fas fa-camera"></i></button>
          <canvas id="canvas" width="100" height="200"></canvas>
          <input type="text" hidden value="" id="patient_answer_photo" name="patient_answer[photo]">
          <script>
            // Grab elements, create settings, etc.
            var video = document.getElementById('video');

            // Get access to the camera!
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
               // Not adding `{ audio: true }` since we only want video now
               navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                   //video.src = window.URL.createObjectURL(stream);
                   video.srcObject = stream;
                   video.play();
               });
            }
            // Elements for taking the snapshot
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            var video = document.getElementById('video');
            const formInput = document.getElementById("patient_answer_photo")

            // Trigger photo take
            document.getElementById('snap').addEventListener('click', function(event) {
             context.drawImage(video, 0, 0, 100, 200);
             const encoded = canvas.toDataURL();
             // const decoded = atob(encoded.split(",")[1]);
             formInput.value = encoded;
             event.preventDefault();
            });
          </script>










            <%#= f.input :photo %>
            <%#= f.input :photo_cache, as: :hidden %>
<!--
            <video id="video" width="100" height="200" autoplay></video>
            <button id="snap"><i class="fas fa-camera"></i></button>
            <canvas id="canvas" width="100" height="200"></canvas>
            <script>
              // Grab elements, create settings, etc.
              var video = document.getElementById('video');
              // Get access to the camera!
              if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                 // Not adding `{ audio: true }` since we only want video now
                 navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                     //video.src = window.URL.createObjectURL(stream);
                     video.srcObject = stream;
                     video.play();
                 });
              }
              // Elements for taking the snapshot
              var canvas = document.getElementById('canvas');
              var context = canvas.getContext('2d');
              var video = document.getElementById('video');

              // Trigger photo take
              document.getElementById('snap').addEventListener('click', function() {
               context.drawImage(video, 0, 0, 640, 480);
              });
              debugger;
            </script>
 -->
        <% else %>
            <%= f.input :content, label: false, wrapper_html: {id: "inputchat"} %>
        <% end %>
  <!--     </div> -->
    <% end %>
    <%= f.submit "Send", id: "submitchat", class: "btn-solid" %>
  <% end %>
<% else  %>
  <%=  link_to 'Submit', diagnoses_path, method: :post, class: "btn btn-solid"%>
<% end %>
